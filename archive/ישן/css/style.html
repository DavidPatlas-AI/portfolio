<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>××¨×›×– ×˜×¨× ×“×™× - {{ date }}</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body style="background-color: {{ bg_color }};">
  <div class="container">
    <div class="section">
      <h2>ğŸ“– ×¡×™×¤×•×¨ ×™×•××™</h2>
      <p>{{ story }}</p>
    </div>

    <div class="section">
      <h2>ğŸ“Œ ×˜×™×¤ ×œ× ×™×ª×•×— ×˜×¨× ×“×™×</h2>
      <p>{{ tip }}</p>
    </div>

    <div class="section">
      <h1 style="color: deeppink;">ğŸ“Š ×“×•×— ×˜×¨× ×“×™× â€“ {{ date }}</h1>
      <ul class="main-list">
        <li><strong>ğŸ¨ ×¦×‘×¢ ×˜×¨× ×“×™:</strong> {{ color }}</li>
        <li><strong>ğŸ˜Š ×¨×’×© ×“×•××™× × ×˜×™:</strong> {{ emotion }}</li>
        <li><strong>ğŸ± ×—×™×” ×¡××œ×™×ª×™×ª:</strong> {{ animal }}</li>
        <li><strong>ğŸ’ª ×¢×•×¦××ª ×”×˜×¨× ×“:</strong> %</li>
        <li><strong>ğŸ’¡ ××™×œ×™× ×—×–×§×•×ª:</strong><br> {{ keywords | join(', ') }}</li>
      </ul>
    </div>

    <div class="section">
      <h2>âš™ ×’×¨×•×¨ ×˜×¨× ×“×™× ×œ×¡×¨×’×œ ×œ××˜×”</h2>
      <div id="trend-list">
        <div class="trend-block" draggable="true" data-type="color">{{ color }}</div>
        <div class="trend-block" draggable="true" data-type="emotion">{{ emotion }}</div>
        <div class="trend-block" draggable="true" data-type="animal">{{ animal }}</div>
        {% for word in keywords %}
          <div class="trend-block" draggable="true" data-type="keyword">{{ word }}</div>
        {% endfor %}
      </div>

      <div class="drop-zone" id="trend-drop">
        ×’×¨×•×¨ ×œ×›××Ÿ ×˜×¨× ×“×™× ×©×¨×œ×•×•× ×˜×™×™× ×”×™×•×
      </div>

      <h2>×˜×‘×œ×ª ×”×ª× ×’×©×•×™×•×ª</h2>
      <table id="collision-table">
        <thead>
          <tr><th>×˜×¨× ×“ 1</th><th>×˜×¨× ×“ 2</th><th>×¡×˜×˜×•×¡</th></tr>
        </thead>
        <tbody id="collision-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    const blocks = document.querySelectorAll('.trend-block');
    const dropZone = document.getElementById('trend-drop');
    const collisionTable = document.getElementById('collision-body');
    let currentTrends = [];

    blocks.forEach(block => {
      block.addEventListener('dragstart', e => {
        e.dataTransfer.setData("text/plain", block.textContent);
        e.dataTransfer.setData("type", block.dataset.type);
      });
    });

    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('over');
    });

    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('over');
      const text = e.dataTransfer.getData("text/plain");
      const type = e.dataTransfer.getData("type");

      const exists = currentTrends.find(t => t.text === text);
      if (!exists) {
        currentTrends.push({ text, type });
        const newElem = document.createElement('span');
        newElem.className = "trend-block";
        newElem.textContent = text;
        dropZone.appendChild(newElem);
        checkCollisions();
      }
    });

    function checkCollisions() {
      collisionTable.innerHTML = '';
      for (let i = 0; i < currentTrends.length; i++) {
        for (let j = i + 1; j < currentTrends.length; j++) {
          let t1 = currentTrends[i];
          let t2 = currentTrends[j];
          let conflict = (t1.type === t2.type) ? "×”×ª× ×’×©×•×ª!" : "××™×Ÿ ×‘×¢×™×”";
          let row = `<tr><td>${t1.text}</td><td>${t2.text}</td><td>${conflict}</td></tr>`;
          collisionTable.innerHTML += row;
        }
      }
    }
  </script>
</body>
</html>
