// מאגר מילות מפתח מקיף לזיהוי לידים - פעמי עתידים
const KEYWORDS_DATABASE = {
    // פטור ושחרור - עדיפות מקסימלית (5)
    military_exemption: {
        name: "פטור ושחרור",
        priority: 5,
        urgency: "דחוף מאוד",
        color: "#dc2626",
        keywords: [
            // פטור בסיסי
            "פטור", "פטור מגיוס", "שחרור", "שוחררתי", "דחייה", "דחיית גיוס",
            "פרופיל 21", "פרופיל נמוך", "פרופיל 45", "קבן", "קב״ן", "פרופיל רפואי",
            "פרופיל 97", "פרופיל נפשי", "פרופיל מוגבל", "פטור זמני", "פטור קבוע",
            
            // ועדות ובדיקות
            "ועדה רפואית", "ועדה נפשית", "בעיה רפואית", "בעיה נפשית", "אבחון רפואי",
            "בדיקה פסיכולוגית", "מאבחן", "פסיכיאטר", "רופא נפש", "אשפוז נפשי",
            "בדיקת כושר", "בדיקה רפואית", "בעיות גב", "בעיות ברכיים", "בעיות לב",
            "מחלה כרונית", "נכות", "פגיעה רפואית", "בעיות ראייה", "בעיות שמיעה",
            
            // התנגדות פעילה
            "לא מתאים לי", "רוצה לצאת", "לבטל גיוס", "לא רוצה להתגייס",
            "לא בנוי לזה", "לא מסוגל לשרת", "אני לא בא", "אני לא מופיע",
            "סעיף נפשי", "תשקיף", "אני לא יציב", "לא כשיר נפשית",
            "לא מגיע לי", "לא אעשה את זה", "מסרב לשרת", "אני מתנגד",
            
            // ביטויי תסכול עם הצבא
            "שונא את הצבא", "לא מאמין במדינה", "זה לא בשבילי", "אין לי סבלנות",
            "לא יכול עם הצווים", "לא אוהב לקבל פקודות", "רוצה חופש", "לא עם המדינה",
            "נגד המלחמה", "פציפיסט", "מתנגד מצפון", "לא אשרת", "לא בצבא"
        ]
    },

    // מצוקה רגשית וחיפוש כיוון - הזדמנות זהב (5)
    emotional_distress: {
        name: "מצוקה רגשית וחיפוש כיוון",
        priority: 5,
        urgency: "דחוף מאוד",
        color: "#f59e0b",
        keywords: [
            // חוסר כיוון
            "אין לי כיוון", "מה עושים", "מתלבט", "אני לא יודע", "אבוד", "מבולבל",
            "קשה לי להחליט", "לא יודע מה אני רוצה", "אין לי מטרה", "אין לי חלום",
            "מה האפשרויות", "אין לי מענה", "מה עושים בחיים", "לאן אני הולך",
            "מה יהיה איתי", "איך ממשיכים", "מה הכיוון שלי", "מה זה בכלל החיים",
            
            // מצוקה רגשית
            "מרגיש לבד", "רוצה תמיכה", "רוצה מסגרת", "צריך הכוונה",
            "מישהו שיכוון אותי", "לא יודע למי לפנות", "מחפש דרך אחרת",
            "רוצה מישהו שידבר איתי", "צריך עזרה", "לא מצליח לבד",
            "צריך ליווי", "רוצה חונך", "צריך מדריך", "רוצה מישהו שיבין",
            
            // תסכול ועייפות
            "נמאס לי", "אין לי חשק", "לא יכול להמשיך", "מתפרק", "אין לי כוחות",
            "עייף נפשית", "לחוץ", "מתח", "פחד מהעתיד", "לא רואה אור",
            "הכל נראה חסר תקווה", "אין לי מוטיבציה", "מה הטעם", "למה בכלל",
            "שבור", "נשבר", "התמוטטתי", "אין לי כוח יותר", "נגמר לי",
            
            // בדידות וחוסר הבנה
            "אף אחד לא מבין אותי", "כולם יודעים מה הם רוצים", "רק אני תקוע",
            "מרגיש שונה", "לא כמו כולם", "רוצה להיות חלק", "אין לי חברים אמיתיים",
            "כולם הולכים לצבא", "נשארתי לבד", "מרגיש מוזר", "לא מתאים לי כלום",
            
            // מחפש משמעות
            "מחפש משמעות", "רוצה להרגיש שווה", "רוצה לעשות משהו חשוב",
            "רוצה להשפיע", "רוצה לעזור", "רוצה לבנות משהו", "רוצה להיות גאה בעצמי"
        ]
    },

    // תכניות מתחרות - מוקד תחרות (4)
    competitive_programs: {
        name: "תכניות מתחרות",
        priority: 4,
        urgency: "גבוה",
        color: "#2563eb",
        keywords: [
            // תכניות מובילות
            "קודקוד", "פרדס", "תלפיות", "ממר״ם", "ממרם", "פסגות", "שחף", "מרום",
            "עתודה", "עתודה אקדמית", "חץ", "לב תל אביב", "מקא״ם", "מקאם",
            "נחשון", "שלדג", "עוקץ", "אתגר", "ברקאי", "מצטיינות", "אלפא",
            "בקע", "הדס", "רווח", "תותח", "טלס", "מגל", "ברק", "רתם",
            
            // יחידות טכנולוגיות
            "8200", "9900", "יחידה מובחרת", "טכנולוגיות עתיד", "קורס מתקדם",
            "מערכות מידע", "סייבר", "אבטחת מידע", "פיתוח תוכנה", "תכנות",
            "חדר מלחמה", "מודיעין", "טכנולוגיה", "הייטק", "מחשבים",
            "אלגוריתמים", "בינה מלאכותית", "ביג דטה", "קריפטוגרפיה",
            
            // שירותים אלטרנטיביים
            "שירות לאומי", "שירות אזרחי", "שנת שירות", "מכינה קדם צבאית",
            "התנדבות", "שירות משמעותי", "חינוך", "רפואה", "קהילה",
            "מד״א", "כבאות", "משטרה", "שירותי חירום", "עמותה",
            "ארגון חברתי", "תנועת נוער", "שירות בתי ספר",
            
            // מונחי יוקרה
            "מובחר", "איכות", "מתקדם", "מיוחד", "נבחר", "עילית", "מצטיין",
            "מוכשר", "מבריק", "גאון", "חכם", "יצירתי", "חדשני"
        ]
    },

    // בעיות נפשיות ורפואיות - טיפול רגיש (4)
    mental_health: {
        name: "בעיות נפשיות ורפואיות",
        priority: 4,
        urgency: "גבוה",
        color: "#7c3aed",
        keywords: [
            // מצבים נפשיים
            "חרדה", "דיכאון", "פאניקה", "טראומה", "פחד", "התקף חרדה",
            "מחשבות אובדניות", "רעידות", "בכי", "הזיות", "פסיכוזה",
            "הפרעת קשב", "הפרעת ריכוז", "אדהד", "ADD", "ADHD",
            "הפרעה דו קוטבית", "הפרעת אישיות", "אוטיזם", "אספרגר",
            "הפרעת אכילה", "בולימיה", "אנורקסיה", "דימוי עצמי",
            
            // טיפולים ותרופות
            "פסיכיאטר", "פסיכולוג", "טיפול נפשי", "כדורים", "תרופות",
            "אנטי דפרסיבי", "זולפט", "ציפרלקס", "ריטלין", "קונצרטה",
            "טיפול התנהגותי", "טיפול קוגניטיבי", "קבוצת תמיכה",
            "שיקום נפשי", "יום טיפולי", "מוקד נפש", "אשפוז יום",
            
            // תופעות פיזיות
            "בעיות שינה", "נדודי שינה", "סיוטים", "חוסר תיאבון",
            "כאבי ראש", "כאבי בטן", "בחילות", "חולשה", "עייפות",
            "לא ישן בלילה", "קם באמצע הלילה", "לא מצליח להירדם",
            
            // מצבי משבר
            "מחשבות על מוות", "רוצה למות", "לא רוצה לחיות",
            "פגעתי בעצמי", "חתכתי את עצמי", "פציעה עצמית",
            "רוצה להיעלם", "לא יכול יותר", "זה נגמר"
        ]
    },

    // אקדמיה ולימודים - הזדמנות טובה (3)
    academic_interests: {
        name: "אקדמיה ולימודים",
        priority: 3,
        urgency: "בינוני",
        color: "#059669",
        keywords: [
            // לימודים כלליים
            "אקדמיה", "לימודים", "תואר", "תואר ראשון", "תואר שני", "מגיסטר",
            "אוניברסיטה", "מכללה", "קמפוס", "סטודנט", "להיות סטודנט",
            "קבלה", "הרשמה", "מועמדות", "קריטריונים", "תנאי קבלה",
            
            // מבחנים ובחינות
            "פסיכומטרי", "בגרות", "ציונים", "ממוצע", "5 יחידות", "4 יחידות",
            "מתמטיקה", "אנגלית", "פיזיקה", "כימיה", "ביולוגיה", "היסטוריה",
            "בחינת כניסה", "ראיון קבלה", "מבחן התאמה", "מבחן יכולת",
            
            // תחומי לימוד טכנולוגיים
            "מדעי המחשב", "הנדסת תוכנה", "מערכות מידע", "הנדסה",
            "הנדסת חשמל", "הנדסת אלקטרוניקה", "מכונות", "תעשייה וניהול",
            "סייבר", "אבטחת מידע", "תכנות", "פיתוח", "קוד", "אלגוריתמים",
            "בינה מלאכותית", "למידת מכונה", "ביג דטה", "פיתוח אפליקציות",
            
            // תחומי לימוד עסקיים
            "כלכלה", "ניהול", "עסקים", "חשבונאות", "מימון", "שיווק",
            "יזמות", "סטארטאפ", "חדשנות", "מנהל עסקים", "MBA",
            "בנקאות", "ביטוח", "יועץ השקעות", "אנליסט", "קונסלטינג",
            
            // תחומי לימוד אחרים
            "פסיכולוגיה", "משפטים", "רפואה", "סיעוד", "רפואת שיניים",
            "וטרינריה", "חינוך", "הוראה", "תקשורת", "עיתונאות",
            "עיצוב", "אמנות", "אדריכלות", "קולנוע", "צילום",
            "ספורט", "פיזיותרפיה", "תזונה", "עבודה סוציאלית",
            
            // מסלולים מיוחדים
            "מסלול י״ג", "מסלול י״ד", "שילוב אקדמיה", "מסלול טכנולוגי",
            "הסבה", "קורס הכשרה", "התמחות", "מלגה", "מלגת לימודים",
            "מלגת מצוינות", "מלגת צרכים", "הלוואת סטודנטים"
        ]
    },

    // מצב כלכלי ותעסוקה - צורך בסיסי (3)
    economic_concerns: {
        name: "מצב כלכלי ותעסוקה",
        priority: 3,
        urgency: "בינוני",
        color: "#0891b2",
        keywords: [
            // בעיות כלכליות
            "אין לי כסף", "בעיות כלכליות", "לא יכול לעבוד", "צריך לעבוד",
            "מצב כלכלי קשה", "אין פרנסה", "אין הכנסה", "אין עבודה",
            "חובות", "הלוואות", "משכנתא", "קשיים כלכליים", "עוני",
            "לא יכול להרשות לעצמי", "יקר מדי", "אין לי תקציב",
            
            // תעסוקה בסיסית
            "עבודה", "משרה", "מקום עבודה", "ראיון עבודה", "קורות חיים",
            "ניסיון עבודה", "משרה זמנית", "עבודה חלקית", "עבודה מלאה",
            "משכורת", "שכר", "תנאי עבודה", "שעות עבודה", "משמרות",
            "עבודה פיזית", "עבודה במשרד", "שירות לקוחות", "מכירות",
            
            // קריירה ופיתוח
            "קריירה", "השמה", "התפתחות מקצועית", "עתיד תעסוקתי",
            "מסלול קידום", "ניהול", "מנהל", "מנהל צוות", "מנהל פרויקטים",
            "ריאות בכיר", "מנכ״ל", "סמנכ״ל", "דירקטור", "VP",
            "בכיר", "מומחה", "מנהל בכיר", "עצמאי", "פרילנסר",
            
            // תחומי עבודה
            "הייטק", "גוגל", "מיקרוסופט", "פייסבוק", "אמזון", "אפל",
            "בנק", "ביטוח", "פיננסים", "השקעות", "נדל״ן", "בנייה",
            "רפואה", "בית חולים", "קופת חולים", "חינוך", "הוראה",
            "ממשלה", "משרד ממשלתי", "רשות מקומית", "עיריה", "צה״ל"
        ]
    },

    // משפחה וחברים - לחץ חברתי (2)
    family_social: {
        name: "משפחה וחברים",
        priority: 2,
        urgency: "נמוך",
        color: "#6b7280",
        keywords: [
            // לחץ משפחתי
            "ההורים שלי", "אבא ואמא", "המשפחה", "לחץ מההורים",
            "רוצים שאלך", "לא מבינים אותי", "כולם מצפים", "לחץ חברתי",
            "אח שלי", "אחות שלי", "בן דוד", "בת דודה", "קרובי משפחה",
            "דוד", "דודה", "סבא", "סבתא", "כולם בצבא", "מסורת משפחתי",
            
            // חברים ועמיתים
            "החברים שלי", "כל החבר״ה", "כולם הולכים", "נשארתי לבד",
            "מרגיש שונה", "לא כמו כולם", "רוצה להיות חלק",
            "הכיתה שלי", "חברי הכיתה", "חברי הילדות", "חברים מהשכונה",
            "כל הבנים", "כל הבנות", "הקבוצה שלי", "החבורה",
            
            // ציפיות חברתיות
            "מה יגידו", "איך זה ייראה", "מה יחשבו עלי", "בושה",
            "נורמלי", "כמו כולם", "לא לבדל", "להשתלב", "להיות חלק",
            "מקובל", "נכון", "צריך", "חובה", "ציפיות"
        ]
    },

    // פעמי עתידים - אזכורים ישירים (5)
    direct_mentions: {
        name: "אזכור ישיר פעמי עתידים",
        priority: 5,
        urgency: "זהב!",
        color: "#dc2626",
        keywords: [
            "פעמי עתידים", "פעמי", "עתידים", "תכנית פעמי", "מסלול עתידים",
            "קרן גרוס", "תכנית תומכת", "ליווי חינוכי", "חונך אישי",
            "שמעתי על פעמי", "מכיר את פעמי", "אמרו לי על", "הכירו לי",
            "ראיתי פרסומת", "קראתי על", "פגשתי מישהו מ", "בוגר פעמי"
        ]
    },

    // מונחים נוספים - תמיכה ומסגרת (3)
    support_structure: {
        name: "חיפוש תמיכה ומסגרת",
        priority: 3,
        urgency: "בינוני",
        color: "#8b5cf6",
        keywords: [
            // חיפוש תמיכה
            "רוצה תמיכה", "צריך עזרה", "מישהו שיעזור", "ליווי", "הדרכה",
            "חונכות", "מנטור", "מדריך", "יועץ", "קבוצת תמיכה",
            "קהילה", "שייכות", "אחווה", "חברות", "משפחה חדשה",
            
            // מסגרת וארגון
            "מסגרת", "מבנה", "סדר", "ארגון", "תכנית", "תוכנית",
            "מסלול מובנה", "מערכת", "סביבה תומכת", "אווירה חיובית",
            "מקום בטוח", "סביבה מקבלת", "ללא שיפוטיות"
        ]
    },

    // הזדמנויות וחלומות (2)
    opportunities_dreams: {
        name: "הזדמנויות וחלומות",
        priority: 2,
        urgency: "נמוך",
        color: "#059669",
        keywords: [
            // חלומות ושאיפות
            "חלום", "שאיפה", "מטרה", "יעד", "רוצה להיות", "רוצה לעשות",
            "רוצה להצליח", "רוצה להשפיע", "רוצה לעזור", "רוצה לבנות",
            "רוצה ליצור", "רוצה לחדש", "רוצה להמציא", "רוצה לפתח",
            
            // הזדמנויות
            "הזדמנות", "אופציה", "אפשרות", "בחירה", "דרך", "מסלול",
            "פתרון", "תשובה", "מענה", "חלופה", "אלטרנטיבה",
            "משהו אחר", "משהו חדש", "משהו שונה", "משהו מיוחד"
        ]
    }
};

// פונקציות עזר לעבודה עם מילות מפתח
const KeywordUtils = {
    // חיפוש מילות מפתח בטקסט
    findKeywords: function(text) {
        const foundKeywords = [];
        const lowerText = text.toLowerCase();
        
        for (const [categoryId, categoryData] of Object.entries(KEYWORDS_DATABASE)) {
            for (const keyword of categoryData.keywords) {
                if (lowerText.includes(keyword.toLowerCase())) {
                    foundKeywords.push({
                        keyword: keyword,
                        category: categoryData.name,
                        categoryId: categoryId,
                        priority: categoryData.priority,
                        urgency: categoryData.urgency,
                        color: categoryData.color
                    });
                }
            }
        }
        
        return foundKeywords;
    },

    // הדגשת מילות מפתח בטקסט
    highlightKeywords: function(text, keywords) {
        let highlightedText = text;
        
        keywords.forEach(keywordObj => {
            const regex = new RegExp(`(${keywordObj.keyword})`, 'gi');
            highlightedText = highlightedText.replace(regex, 
                `<span class="keyword-highlight" style="background-color: ${keywordObj.color}20; color: ${keywordObj.color}; font-weight: bold;">$1</span>`
            );
        });
        
        return highlightedText;
    },

    // חישוב ציון עדיפות כולל
    calculatePriorityScore: function(keywords) {
        if (keywords.length === 0) return 0;
        
        const maxPriority = Math.max(...keywords.map(k => k.priority));
        const avgPriority = keywords.reduce((sum, k) => sum + k.priority, 0) / keywords.length;
        
        return Math.round((maxPriority * 0.7 + avgPriority * 0.3) * 10) / 10;
    },

    // קבלת צבע לפי עדיפות
    getPriorityColor: function(priority) {
        if (priority >= 5) return "#dc2626"; // אדום - דחוף
        if (priority >= 4) return "#f59e0b"; // כתום - גבוה
        if (priority >= 3) return "#059669"; // ירוק - בינוני
        if (priority >= 2) return "#0891b2"; // כחול - נמוך
        return "#6b7280"; // אפור - רגיל
    },

    // קבלת טקסט עדיפות
    getPriorityText: function(priority) {
        if (priority >= 5) return "דחוף מאוד ⚡";
        if (priority >= 4) return "עדיפות גבוהה 🔥";
        if (priority >= 3) return "עדיפות בינונית 📋";
        if (priority >= 2) return "עדיפות נמוכה 📝";
        return "רגיל";
    },

    // קבלת קטגוריות יחידות
    getUniqueCategories: function(keywords) {
        return [...new Set(keywords.map(k => k.category))];
    },

    // מיון מילות מפתח לפי עדיפות
    sortByPriority: function(keywords) {
        return keywords.sort((a, b) => b.priority - a.priority);
    },

    // סטטיסטיקות על מילות המפתח
    getKeywordStats: function() {
        const stats = {
            totalCategories: Object.keys(KEYWORDS_DATABASE).length,
            totalKeywords: 0,
            categoriesBreakdown: {}
        };

        for (const [categoryId, categoryData] of Object.entries(KEYWORDS_DATABASE)) {
            stats.totalKeywords += categoryData.keywords.length;
            stats.categoriesBreakdown[categoryData.name] = {
                count: categoryData.keywords.length,
                priority: categoryData.priority,
                urgency: categoryData.urgency
            };
        }

        return stats;
    }
};

// ייצוא למודולים אחרים
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { KEYWORDS_DATABASE, KeywordUtils };
}