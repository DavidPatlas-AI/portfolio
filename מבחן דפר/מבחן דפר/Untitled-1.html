<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מבחן דפ"ר - מצב אופליין</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3498db">
    <meta name="description" content="מבחן דפ"ר לתרגול - פועל גם במצב אופליין">
</head>
<body>
    <div class="top-bar">
        <h1>מבחן דפ"ר - מצב אופליין</h1>
        <div class="timer-container">
            <span id="timer">45:00</span>
            <button onclick="toggleTimer()" id="timerControl">התחל</button>
        </div>
    </div>

    <div class="control-panel">
        <div class="test-type-selector">
            <button onclick="setTestType('practice')" class="test-type-btn active">תרגול חופשי</button>
            <button onclick="setTestType('real')" class="test-type-btn">מבחן מלא</button>
            <button onclick="setTestType('quick')" class="test-type-btn">תרגול מהיר</button>
        </div>

        <div class="navigation-buttons">
            <button onclick="showSection('analogies')" class="nav-btn" data-section="analogies">
                אנלוגיות מילוליות
                <span class="section-score">0/25</span>
            </button>
            <button onclick="showSection('sequences')" class="nav-btn" data-section="sequences">
                השלמת סדרות
                <span class="section-score">0/25</span>
            </button>
            <button onclick="showSection('shapes')" class="nav-btn" data-section="shapes">
                סדרות צורות
                <span class="section-score">0/25</span>
            </button>
            <button onclick="showSection('quantitative')" class="nav-btn" data-section="quantitative">
                חשיבה כמותית
                <span class="section-score">0/25</span>
            </button>
            <button onclick="showSection('logic')" class="nav-btn" data-section="logic">
                היסקים לוגיים
                <span class="section-score">0/25</span>
            </button>
        </div>

        <div class="utility-buttons">
            <button onclick="showStats()" class="util-btn">סטטיסטיקות</button>
            <button onclick="showMarked()" class="util-btn">שאלות מסומנות</button>
            <button onclick="saveProgress()" class="util-btn">שמור התקדמות</button>
            <button onclick="toggleTips()" class="util-btn">טיפים והסברים</button>
            <button onclick="showMistakes()" class="util-btn">ניתוח טעויות</button>
        </div>

        <div class="test-tools">
            <button onclick="toggleCalculator()" class="tool-btn">מחשבון</button>
            <button onclick="toggleScratchPad()" class="tool-btn">דף טיוטה</button>
            <button onclick="toggleFormulas()" class="tool-btn">נוסחאות</button>
            <button onclick="toggleInstructions()" class="tool-btn">הוראות</button>
        </div>
    </div>

    <div class="score-display">
        <div>ציון: <span id="totalScore">0</span></div>
        <div class="progress-bar">
            <div id="progressBarFill" class="progress-bar-fill" style="width: 0%"></div>
        </div>
        <div id="offlineStatus" class="offline-status"></div>
    </div>

    <div class="container">
        <div class="window" id="analogiesWindow">
            <h2>אנלוגיות מילוליות</h2>
            <div id="analogyQuestion" class="question"></div>
            <div id="analogyOptions" class="options"></div>
            <button onclick="nextAnalogy()">שאלה הבאה</button>
            <div id="analogyResult" class="result"></div>
        </div>

        <div class="window" id="sequenceWindow">
            <h2>השלמת סדרות</h2>
            <div id="sequenceQuestion" class="question"></div>
            <input type="number" id="sequenceInput" placeholder="הכנס את המספר הבא בסדרה">
            <button onclick="checkSequence()">בדוק</button>
            <div id="sequenceResult" class="result"></div>
        </div>

        <div class="window" id="shapesWindow">
            <h2>סדרות צורות</h2>
            <div id="shapeQuestion" class="question"></div>
            <div id="shapeOptions" class="options"></div>
            <button onclick="nextShape()">שאלה הבאה</button>
            <div id="shapeResult" class="result"></div>
        </div>

        <div class="window" id="quantitativeWindow">
            <h2>חשיבה כמותית</h2>
            <div id="mathQuestion" class="question"></div>
            <input type="number" id="mathInput" placeholder="הכנס את התשובה">
            <button onclick="checkMath()">בדוק</button>
            <div id="mathResult" class="result"></div>
        </div>

        <div class="window" id="logicWindow">
            <h2>היסקים לוגיים</h2>
            <div id="logicQuestion" class="question"></div>
            <div id="logicOptions" class="options"></div>
            <button onclick="checkLogic()">בדוק</button>
            <div id="logicResult" class="result"></div>
        </div>
    </div>

    <div id="calculator" class="tool-window" style="display: none;">
        <!-- Basic calculator interface -->
        <div class="calculator-grid">
            <!-- Calculator buttons will be added by JavaScript -->
        </div>
    </div>

    <div id="scratchPad" class="tool-window" style="display: none;">
        <canvas id="drawingPad"></canvas>
        <div class="drawing-tools">
            <button onclick="clearPad()">נקה</button>
            <input type="color" id="colorPicker" value="#000000">
            <input type="range" id="brushSize" min="1" max="20" value="5">
        </div>
    </div>

    <div id="formulas" class="tool-window" style="display: none;">
        <h3>נוסחאות שימושיות</h3>
        <div class="formulas-content">
            <div class="formula-category">
                <h4>גיאומטריה</h4>
                <p>שטח מלבן = אורך × רוחב</p>
                <p>שטח משולש = (בסיס × גובה) ÷ 2</p>
                <p>שטח מעגל = πr²</p>
            </div>
            <div class="formula-category">
                <h4>אלגברה</h4>
                <p>(a + b)² = a² + 2ab + b²</p>
                <p>(a - b)² = a² - 2ab + b²</p>
            </div>
        </div>
    </div>

    <div class="utility-tools">
        <div class="tool-section">
            <h3>כלי עזר נוספים</h3>
            
            <!-- Temperature Converter -->
            <div class="tool-card">
                <h4>ממיר טמפרטורות</h4>
                <div class="converter">
                    <input type="number" id="celsius" placeholder="הכנס טמפרטורה בצלזיוס">
                    <button onclick="convertTemperature()">המר</button>
                    <div id="tempResult" class="result"></div>
                </div>
            </div>

            <!-- Random Sentence Generator -->
            <div class="tool-card">
                <h4>מחולל משפטים לתרגול אנלוגיות</h4>
                <button onclick="generateSentence()">צור משפט לתרגול</button>
                <div id="sentenceResult" class="result"></div>
            </div>

            <!-- Strong Password Generator -->
            <div class="tool-card">
                <h4>מחולל סיסמאות</h4>
                <button onclick="generatePassword()">צור סיסמה</button>
                <div id="passwordResult" class="result"></div>
            </div>

            <!-- Time Calculator -->
            <div class="tool-card">
                <h4>מחשבון זמן</h4>
                <input type="date" id="date1">
                <input type="date" id="date2">
                <button onclick="calculateTimeDifference()">חשב</button>
                <div id="timeResult" class="result"></div>
            </div>
        </div>

        <!-- Practice Tools -->
        <div class="practice-section">
            <h3>כלים לתרגול</h3>
            
            <!-- Number Sequence Practice -->
            <div class="tool-card">
                <h4>תרגול סדרות מספרים</h4>
                <div id="sequencePractice">
                    <div id="currentSequence"></div>
                    <input type="number" id="sequenceAnswer" placeholder="המספר הבא בסדרה">
                    <button onclick="checkSequencePractice()">בדוק</button>
                    <button onclick="generateNewSequence()">סדרה חדשה</button>
                </div>
            </div>

            <!-- Word Relations Practice -->
            <div class="tool-card">
                <h4>בדיקת קשרים מילוליים</h4>
                <div id="wordRelations">
                    <input type="text" id="word1" placeholder="מילה ראשונה">
                    <input type="text" id="word2" placeholder="מילה שנייה">
                    <button onclick="analyzeWordRelation()">בדוק קשר</button>
                    <button onclick="getRandomWordPair()">זוג מילים אקראי</button>
                </div>
            </div>

            <!-- Logic Problems -->
            <div class="tool-card">
                <h4>פתרון בעיות לוגיות</h4>
                <div id="logicPractice">
                    <button onclick="generateLogicProblem()">בעיה חדשה</button>
                    <div id="logicProblemText"></div>
                    <div id="logicAnswerOptions"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="programming-tools">
        <h2>כלי עזר לתכנות</h2>
        
        <!-- HTML Reference -->
        <div class="tool-card code-reference">
            <h3>HTML - תגיות נפוצות</h3>
            <div class="code-examples">
                <div class="code-item">
                    <h4>מבנה בסיסי</h4>
                    <pre><code>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;כותרת הדף&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;כותרת ראשית&lt;/h1&gt;
    &lt;p&gt;פסקה&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
                    </code></pre>
                </div>
                <div class="code-item">
                    <h4>טפסים</h4>
                    <pre><code>
&lt;form action="/submit" method="post"&gt;
    &lt;input type="text" name="username"&gt;
    &lt;input type="password" name="password"&gt;
    &lt;button type="submit"&gt;שלח&lt;/button&gt;
&lt;/form&gt;
                    </code></pre>
                </div>
                <div class="code-item">
                    <h4>טבלאות</h4>
                    <pre><code>
&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;כותרת&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;תא&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
                    </code></pre>
                </div>
            </div>
        </div>

        <!-- Python Reference -->
        <div class="tool-card code-reference">
            <h3>Python - דוגמאות קוד</h3>
            <div class="code-examples">
                <div class="code-item">
                    <h4>לולאות ותנאים</h4>
                    <pre><code>
# For Loop
for i in range(5):
    print(i)

# While Loop
x = 0
while x < 5:
    print(x)
    x += 1

# If Statement
if x > 0:
    print("חיובי")
elif x < 0:
    print("שלילי")
else:
    print("אפס")
                    </code></pre>
                </div>
                <div class="code-item">
                    <h4>פונקציות</h4>
                    <pre><code>
def factorial(n):
    if n == 0:
        return 1
    return n * factorial(n-1)

# List Comprehension
squares = [x**2 for x in range(10)]

# Dictionary
person = {
    "name": "ישראל",
    "age": 25
}
                    </code></pre>
                </div>
            </div>
        </div>

        <!-- Java Reference -->
        <div class="tool-card code-reference">
            <h3>Java - דוגמאות קוד</h3>
            <div class="code-examples">
                <div class="code-item">
                    <h4>מחלקה בסיסית</h4>
                    <pre><code>
public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }
}
                    </code></pre>
                </div>
                <div class="code-item">
                    <h4>מערכים ולולאות</h4>
                    <pre><code>
// Array
int[] numbers = new int[5];

// For Loop
for (int i = 0; i < numbers.length; i++) {
    numbers[i] = i * 2;
}

// Enhanced For
for (int num : numbers) {
    System.out.println(num);
}
                    </code></pre>
                </div>
            </div>
        </div>

        <!-- C Reference -->
        <div class="tool-card code-reference">
            <h3>C - דוגמאות קוד</h3>
            <div class="code-examples">
                <div class="code-item">
                    <h4>פונקציות ומצביעים</h4>
                    <pre><code>
#include &lt;stdio.h&gt;

void swap(int *a, int *b) {
    int temp = *a;
    *a = *b;
    *b = temp;
}

int main() {
    int x = 5, y = 10;
    swap(&x, &y);
    printf("%d %d\n", x, y);
    return 0;
}
                    </code></pre>
                </div>
                <div class="code-item">
                    <h4>מבני נתונים</h4>
                    <pre><code>
struct Person {
    char name[50];
    int age;
};

// Using Struct
struct Person person1;
strcpy(person1.name, "ישראל");
person1.age = 25;
                    </code></pre>
                </div>
            </div>
        </div>

        <!-- Programming Practice -->
        <div class="tool-card">
            <h3>תרגול תכנות</h3>
            <div class="practice-section">
                <button onclick="generateCodingProblem()">קבל תרגיל תכנות</button>
                <div id="codingProblem" class="problem-display"></div>
                <textarea id="codeSubmission" placeholder="כתוב את הפתרון שלך כאן"></textarea>
                <button onclick="checkCode()">בדוק פתרון</button>
            </div>
        </div>
    </div>

    <div class="advanced-practice-section">
        <h2>תרגול מתקדם לדפ"ר</h2>
        
        <!-- Advanced Verbal Section -->
        <div class="practice-module verbal-advanced">
            <h3>תרגול מתקדם - חשיבה מילולית</h3>
            <div class="practice-content">
                <!-- Sentence Completion -->
                <div class="practice-subsection">
                    <h4>השלמת משפטים</h4>
                    <div class="exercise-container">
                        <div class="exercise">
                            <p>השלם את המשפט באופן הגיוני:</p>
                            <p class="sentence-completion">למרות ש_____ היה עייף מאוד, הוא _____ להמשיך בעבודתו.</p>
                            <div class="options">
                                <button onclick="checkSentenceCompletion(0)">העובד / התעקש</button>
                                <button onclick="checkSentenceCompletion(1)">המנהל / הלך</button>
                                <button onclick="checkSentenceCompletion(2)">הילד / ישן</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Word Relations Advanced -->
                <div class="practice-subsection">
                    <h4>יחסי מילים מורכבים</h4>
                    <div class="exercise-container">
                        <div class="exercise">
                            <p>מצא את היחס המורכב:</p>
                            <p class="word-relations">מחקר : תגלית = ?</p>
                            <div class="options">
                                <button onclick="checkWordRelation(0)">לימוד : ידע</button>
                                <button onclick="checkWordRelation(1)">ספר : דף</button>
                                <button onclick="checkWordRelation(2)">עט : כתיבה</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Quantitative Section -->
        <div class="practice-module quantitative-advanced">
            <h3>תרגול מתקדם - חשיבה כמותית</h3>
            <div class="practice-content">
                <!-- Complex Problem Solving -->
                <div class="practice-subsection">
                    <h4>פתרון בעיות מורכבות</h4>
                    <div class="exercise-container">
                        <div class="exercise">
                            <p>בעיה משולבת - אחוזים וגיאומטריה:</p>
                            <div class="problem-description">
                                <p>שטח מלבן גדל ב-20%. אם אורכו גדל ב-10%, בכמה אחוזים גדל רוחבו?</p>
                            </div>
                            <input type="number" id="complexProblemAnswer" placeholder="הכנס את התשובה">
                            <button onclick="checkComplexProblem()">בדוק תשובה</button>
                        </div>
                    </div>
                </div>

                <!-- Data Analysis -->
                <div class="practice-subsection">
                    <h4>ניתוח נתונים וגרפים</h4>
                    <div class="exercise-container">
                        <canvas id="dataChart" width="400" height="200"></canvas>
                        <div class="data-questions">
                            <p>על פי הגרף, מה היה אחוז השינוי בין 2020 ל-2021?</p>
                            <input type="number" id="dataAnalysisAnswer" placeholder="הכנס את התשובה באחוזים">
                            <button onclick="checkDataAnalysis()">בדוק תשובה</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Logical Section -->
        <div class="practice-module logical-advanced">
            <h3>תרגול מתקדם - חשיבה לוגית</h3>
            <div class="practice-content">
                <!-- Complex Logic Puzzles -->
                <div class="practice-subsection">
                    <h4>חידות לוגיות מורכבות</h4>
                    <div class="exercise-container">
                        <div class="exercise">
                            <p>פתור את החידה הלוגית:</p>
                            <div class="logic-puzzle">
                                <p>בבניין 5 דיירים בקומות שונות:</p>
                                <ul>
                                    <li>דני גר מעל יוסי</li>
                                    <li>רונית גרה שתי קומות מתחת לשרה</li>
                                    <li>משה גר בקומה השנייה</li>
                                    <li>יוסי לא גר בקומה הראשונה</li>
                                </ul>
                                <p>באיזו קומה גרה שרה?</p>
                            </div>
                            <input type="number" id="logicPuzzleAnswer" placeholder="הכנס את מספר הקומה">
                            <button onclick="checkLogicPuzzle()">בדוק תשובה</button>
                        </div>
                    </div>
                </div>

                <!-- Pattern Recognition -->
                <div class="practice-subsection">
                    <h4>זיהוי דפוסים מורכבים</h4>
                    <div class="exercise-container">
                        <div class="pattern-grid">
                            <!-- Pattern grid will be generated by JavaScript -->
                        </div>
                        <p>מה יופיע במשבצת הבאה?</p>
                        <div class="pattern-options">
                            <button onclick="checkPattern(0)">A</button>
                            <button onclick="checkPattern(1)">B</button>
                            <button onclick="checkPattern(2)">C</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Strategies Section -->
        <div class="practice-module test-strategies">
            <h3>אסטרטגיות למבחן</h3>
            <div class="strategy-content">
                <div class="strategy-card">
                    <h4>ניהול זמן</h4>
                    <ul>
                        <li>הקצה 45 שניות לכל שאלה</li>
                        <li>דלג על שאלות קשות וחזור אליהן בסוף</li>
                        <li>השאר 5 דקות בסוף לבדיקה</li>
                    </ul>
                </div>
                <div class="strategy-card">
                    <h4>טכניקות פתרון</h4>
                    <ul>
                        <li>שיטת האלימינציה בשאלות רב-ברירה</li>
                        <li>זיהוי מילות מפתח בשאלות מילוליות</li>
                        <li>שרטוט דיאגרמות בשאלות כמותיות</li>
                    </ul>
                </div>
                <div class="strategy-card">
                    <h4>טיפים לשיפור ביצועים</h4>
                    <ul>
                        <li>קרא את כל האפשרויות לפני שאתה עונה</li>
                        <li>סמן תשובות שאתה לא בטוח בהן לחזרה</li>
                        <li>בדוק את ההיגיון בתשובה שבחרת</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="python-practice-section">
        <h2>תרגול פייתון לחשיבה לוגית</h2>
        
        <!-- Python Fundamentals -->
        <div class="practice-module python-basics">
            <h3>יסודות פייתון לפתרון בעיות</h3>
            
            <!-- List Comprehension Examples -->
            <div class="code-example">
                <h4>הבנת List Comprehension</h4>
                <pre><code class="python">
# דוגמה בסיסית
numbers = [1, 2, 3, 4, 5]
squares = [x**2 for x in numbers]  # [1, 4, 9, 16, 25]

# דוגמה עם תנאי
even_squares = [x**2 for x in numbers if x % 2 == 0]  # [4, 16]

# תרגיל: צור רשימה של כל המספרים שמתחלקים ב-3 בטווח 1-20
# your_solution = [x for x in range(1, 21) if x % 3 == 0]
                </code></pre>
                <button onclick="checkPythonSolution('list_comprehension')">בדוק פתרון</button>
            </div>

            <!-- Pattern Matching with Python -->
            <div class="code-example">
                <h4>זיהוי דפוסים עם פייתון</h4>
                <pre><code class="python">
def find_pattern(sequence):
    """
    מוצא את הדפוס בסדרה של מספרים
    לדוגמה: [2, 4, 8, 16] -> כפל ב-2
    """
    if len(sequence) < 2:
        return "נדרשים לפחות שני מספרים"
    
    # בדיקת דפוס כפל
    if all(sequence[i+1] / sequence[i] == sequence[1] / sequence[0] 
           for i in range(len(sequence)-1)):
        return f"כפל ב-{sequence[1]/sequence[0]}"
    
    # בדיקת דפוס חיבור
    if all(sequence[i+1] - sequence[i] == sequence[1] - sequence[0] 
           for i in range(len(sequence)-1)):
        return f"חיבור {sequence[1]-sequence[0]}"
    
    return "לא נמצא דפוס פשוט"

# תרגיל: כתוב פונקציה שמנבאת את המספר הבא בסדרה
                </code></pre>
                <input type="text" id="sequence_input" placeholder="הכנס סדרה (לדוגמה: 2,4,8,16)">
                <button onclick="analyzePythonSequence()">נתח סדרה</button>
            </div>

            <!-- Recursive Problem Solving -->
            <div class="code-example">
                <h4>פתרון בעיות עם רקורסיה</h4>
                <pre><code class="python">
def fibonacci_recursive(n):
    """
    חישוב המספר ה-n בסדרת פיבונאצ'י
    """
    if n <= 1:
        return n
    return fibonacci_recursive(n-1) + fibonacci_recursive(n-2)

def factorial_recursive(n):
    """
    חישוב עצרת של מספר
    """
    if n <= 1:
        return 1
    return n * factorial_recursive(n-1)

# תרגיל: כתוב פונקציה רקורסיבית שמחשבת את סכום הספרות של מספר
                </code></pre>
                <input type="number" id="recursive_input" placeholder="הכנס מספר">
                <button onclick="calculateRecursive()">חשב</button>
            </div>
        </div>

        <!-- Advanced Python Problems -->
        <div class="practice-module python-advanced">
            <h3>תרגילי פייתון מתקדמים</h3>
            
            <!-- Algorithm Implementation -->
            <div class="code-example">
                <h4>מימוש אלגוריתמים</h4>
                <pre><code class="python">
def binary_search(arr, target):
    """
    חיפוש בינארי - דוגמה ליעילות אלגוריתמית
    """
    left, right = 0, len(arr) - 1
    
    while left <= right:
        mid = (left + right) // 2
        if arr[mid] == target:
            return mid
        elif arr[mid] < target:
            left = mid + 1
        else:
            right = mid - 1
    
    return -1

# תרגיל: ממש אלגוריתם מיון (לדוגמה: bubble sort)
                </code></pre>
                <button onclick="testAlgorithm()">בדוק אלגוריתם</button>
            </div>

            <!-- Data Structure Problems -->
            <div class="code-example">
                <h4>פתרון בעיות עם מבני נתונים</h4>
                <pre><code class="python">
class Stack:
    def __init__(self):
        self.items = []
    
    def push(self, item):
        self.items.append(item)
    
    def pop(self):
        return self.items.pop() if self.items else None
    
    def is_empty(self):
        return len(self.items) == 0

def check_balanced_parentheses(expression):
    """
    בדיקת סוגריים מאוזנים באמצעות מחסנית
    """
    stack = Stack()
    pairs = {')': '(', ']': '[', '}': '{'}
    
    for char in expression:
        if char in '([{':
            stack.push(char)
        elif char in ')]}':
            if stack.is_empty() or stack.pop() != pairs[char]:
                return False
    
    return stack.is_empty()

# תרגיל: ממש תור (Queue) עם פעולות בסיסיות
                </code></pre>
                <input type="text" id="expression_input" placeholder="הכנס ביטוי עם סוגריים">
                <button onclick="checkExpression()">בדוק ביטוי</button>
            </div>

            <!-- Problem-Solving Strategies -->
            <div class="code-example">
                <h4>אסטרטגיות לפתרון בעיות</h4>
                <pre><code class="python">
def solve_problem(problem):
    """
    תבנית לפתרון בעיות:
    1. הבן את הבעיה
    2. תכנן את הפתרון
    3. פרק לתתי-משימות
    4. בדוק קלטים מיוחדים
    """
    # 1. ניתוח הבעיה
    if not validate_input(problem):
        return "קלט לא תקין"
    
    # 2. תכנון הפתרון
    solution_plan = break_into_steps(problem)
    
    # 3. מימוש הפתרון
    result = implement_solution(solution_plan)
    
    # 4. בדיקת הפתרון
    if not verify_solution(result):
        return "נדרשת בדיקה נוספת"
    
    return result

# תרגיל: השתמש בתבנית זו לפתרון בעיה ספציפית
                </code></pre>
                <textarea id="problem_input" placeholder="תאר את הבעיה שברצונך לפתור"></textarea>
                <button onclick="analyzeProblem()">נתח בעיה</button>
            </div>
        </div>

        <!-- Python Tips and Best Practices -->
        <div class="practice-module python-tips">
            <h3>טיפים ושיטות עבודה בפייתון</h3>
            <div class="tips-container">
                <div class="tip-card">
                    <h4>כתיבת קוד יעיל</h4>
                    <ul>
                        <li>השתמש ב-list comprehension במקום לולאות פשוטות</li>
                        <li>העדף פונקציות מובנות על פני מימוש עצמאי</li>
                        <li>השתמש בגנרטורים לחיסכון בזיכרון</li>
                    </ul>
                </div>
                <div class="tip-card">
                    <h4>דיבוג יעיל</h4>
                    <ul>
                        <li>השתמש בהדפסות debug אסטרטגיות</li>
                        <li>בדוק מקרי קצה</li>
                        <li>השתמש ב-try-except לטיפול בשגיאות</li>
                    </ul>
                </div>
                <div class="tip-card">
                    <h4>שיפור ביצועים</h4>
                    <ul>
                        <li>השתמש במבני נתונים מתאימים</li>
                        <li>הימנע מחישובים מיותרים</li>
                        <li>שקול שימוש בcaching</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered');
                        checkOfflineStatus();
                    })
                    .catch(error => {
                        console.error('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Offline Status Check
        function checkOfflineStatus() {
            if (!navigator.onLine) {
                document.body.classList.add('offline');
                showOfflineNotification();
            }
            
            window.addEventListener('online', () => {
                document.body.classList.remove('offline');
                hideOfflineNotification();
                syncData();
            });
            
            window.addEventListener('offline', () => {
                document.body.classList.add('offline');
                showOfflineNotification();
            });
        }

        // Data Synchronization
        function syncData() {
            const pendingData = localStorage.getItem('pendingSync');
            if (pendingData) {
                try {
                    const data = JSON.parse(pendingData);
                    // Sync data with server when online
                    localStorage.removeItem('pendingSync');
                } catch (error) {
                    console.error('Error syncing data:', error);
                }
            }
        }

        // Error Recovery
        function handleError(error) {
            console.error('Application error:', error);
            showErrorNotification();
            // Save error details for later reporting
            localStorage.setItem('errorLog', JSON.stringify({
                timestamp: new Date().toISOString(),
                error: error.message
            }));
        }

        // Performance Monitoring
        function checkPerformance() {
            const metrics = {
                memory: performance.memory,
                timing: performance.timing,
                navigation: performance.navigation
            };
            
            if (metrics.memory && metrics.memory.usedJSHeapSize > 0.9 * metrics.memory.jsHeapSizeLimit) {
                console.warn('High memory usage detected');
            }
        }

        // Service Worker Registration with better error handling
        if ('serviceWorker' in navigator && (window.location.protocol === 'http:' || window.location.protocol === 'https:')) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js') // Make sure sw.js is in the correct path relative to your HTML file
                    .then(registration => {
                        console.log('Service Worker registered successfully');
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        console.log('New content is available, please refresh.');
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => console.error('Service Worker registration failed:', error));
            });
        }

        // Enhanced question bank with more authentic questions
        const questionBank = {
            analogies: [
                {
                    question: "עיפרון : נייר = מברשת : ?",
                    options: ["צבע", "בד", "קנבס", "שיער"],
                    correct: 2,
                    explanation: "כמו שעיפרון משמש לכתיבה על נייר, מברשת משמשת לציור על קנבס"
                },
                {
                    question: "רופא : חולה = מורה : ?",
                    options: ["כיתה", "תלמיד", "ספר", "בית ספר"],
                    correct: 1,
                    explanation: "כמו שרופא מטפל בחולה, מורה מלמד תלמיד"
                },
                {
                    question: "ספר : קריאה = סרט : ?",
                    options: ["טלוויזיה", "צפייה", "בידור", "קולנוע"],
                    correct: 1,
                    explanation: "כמו שספר נועד לקריאה, סרט נועד לצפייה"
                },
                {
                    question: "שעון : זמן = מד-חום : ?",
                    options: ["חום", "מעלות", "טמפרטורה", "מדידה"],
                    correct: 2,
                    explanation: "כמו ששעון מודד זמן, מד-חום מודד טמפרטורה"
                },
                {
                    question: "מילון : מילים = אטלס : ?",
                    options: ["ספר", "מפות", "תמונות", "מדינות"],
                    correct: 1,
                    explanation: "כמו שמילון הוא אוסף של מילים, אטלס הוא אוסף של מפות"
                }
            ],
            sequences: [
                {
                    pattern: [2, 4, 8, 16, 32],
                    next: 64,
                    rule: "כל מספר הוא כפול 2 מהמספר הקודם"
                },
                {
                    pattern: [1, 3, 6, 10, 15],
                    next: 21,
                    rule: "כל מספר מוסיף את המיקום שלו בסדרה"
                },
                {
                    pattern: [1, 4, 9, 16, 25],
                    next: 36,
                    rule: "כל מספר הוא ריבוע של המיקום שלו בסדרה"
                },
                {
                    pattern: [3, 6, 12, 24, 48],
                    next: 96,
                    rule: "כל מספר הוא כפול 2 מהמספר הקודם"
                },
                {
                    pattern: [100, 90, 82, 76, 72],
                    next: 70,
                    rule: "ההפרש בין כל שני מספרים עוקבים קטן ב-2"
                }
            ],
            shapes: [
                {
                    question: "אם בסדרה כל צורה מסתובבת 45 מעלות ימינה, מה תהיה הצורה הבאה?",
                    options: ["↑", "↗", "→", "↘"],
                    correct: 2
                },
                {
                    question: "אם בכל שלב נוסף משולש קטן בפינה, כמה משולשים יהיו בצורה הבאה?",
                    options: ["3", "4", "5", "6"],
                    correct: 2
                }
            ],
            quantitative: [
                {
                    question: "20% מ-80 הוא:",
                    answer: 16,
                    explanation: "20% = 0.2, לכן 0.2 × 80 = 16"
                },
                {
                    question: "אם 3x + 5 = 20, אז x שווה:",
                    answer: 5,
                    explanation: "3x = 15, לכן x = 5"
                },
                {
                    question: "מהו השטח של מלבן שאורכו 8 מטר ורוחבו 6 מטר?",
                    answer: 48,
                    explanation: "שטח מלבן = אורך × רוחב = 8 × 6 = 48 מ\"ר"
                },
                {
                    question: "אם מחיר מוצר עלה ב-20% ואז ירד ב-20%, מה המחיר הסופי ביחס למחיר המקורי? (אם המחיר המקורי 100, מה המחיר הסופי?)",
                    answer: 96,
                    explanation: "עלייה של 20% ואז ירידה של 20% שווה ל: 100 × 1.2 × 0.8 = 96"
                },
                {
                    question: "אם 15% מ-x שווה ל-30, מה הערך של x?",
                    answer: 200,
                    explanation: "15% = 0.15, לכן 0.15x = 30, ולכן x = 30/0.15 = 200"
                }
            ],
            logic: [
                {
                    question: "כל הציפורים יכולות לעוף. פינגווין הוא ציפור. האם פינגווין יכול לעוף?",
                    options: ["כן", "לא", "אי אפשר לדעת"],
                    correct: 0,
                    explanation: "לפי ההנחות שניתנו (גם אם אינן נכונות במציאות), אם כל הציפורים יכולות לעוף ופינגווין הוא ציפור, אז בהכרח פינגווין יכול לעוף"
                },
                {
                    question: "אם כל A הוא B, וכל B הוא C, אז:",
                    options: ["כל A הוא C", "חלק מ-A הוא C", "אי אפשר לדעת"],
                    correct: 0,
                    explanation: "זהו היסק לוגי טרנזיטיבי - אם כל A הוא B וכל B הוא C, אז בהכרח כל A הוא גם C"
                },
                {
                    question: "דני גבוה מיוסי. יוסי גבוה מרון. מי הכי נמוך?",
                    options: ["דני", "יוסי", "רון"],
                    correct: 2,
                    explanation: "אם דני גבוה מיוסי ויוסי גבוה מרון, אז בהכרח רון הוא הנמוך ביותר"
                },
                {
                    question: "אם לא נכון שכל הפירות מתוקים, אז:",
                    options: ["כל הפירות חמוצים", "יש פרי שאינו מתוק", "אין פירות מתוקים"],
                    correct: 1,
                    explanation: "אם לא נכון שכל הפירות מתוקים, המשמעות היא שקיים לפחות פרי אחד שאינו מתוק"
                }
            ]
        };

        // Improved local storage handling
        class LocalStorageManager {
            static getItem(key, defaultValue) {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            }

            static setItem(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }
        }

        // Initialize scores with better persistence
        let currentScores = LocalStorageManager.getItem('currentScores', {
            analogies: 0,
            sequences: 0,
            shapes: 0,
            quantitative: 0,
            logic: 0
        });

        let totalScore = LocalStorageManager.getItem('totalScore', 0);

        function updateScore(points, category) {
            currentScores[category] += points;
            totalScore += points;
            
            LocalStorageManager.setItem('currentScores', currentScores);
            LocalStorageManager.setItem('totalScore', totalScore);
            
            document.getElementById('totalScore').textContent = totalScore;
            updateProgressBar();
        }

        function updateProgressBar() {
            const progressBar = document.getElementById('progressBarFill');
            const maxPossibleScore = 500; // Adjusted based on total possible points
            const percentage = Math.min((totalScore / maxPossibleScore) * 100, 100);
            progressBar.style.width = percentage + '%';
            progressBar.title = `${Math.round(percentage)}% הושלם`;
        }

        function updateOnlineStatus() {
            const status = navigator.onLine;
            const statusElement = document.getElementById('offlineStatus');
            statusElement.className = 'offline-status ' + (status ? 'online' : 'offline');
            statusElement.textContent = status ? 'מחובר למצב אונליין' : 'במצב אופליין - כל הנתונים נשמרים מקומית';
        }

        let currentAnalogy = 0;
        function nextAnalogy() {
            const analogy = questionBank.analogies[currentAnalogy % questionBank.analogies.length];
            const questionDiv = document.getElementById('analogyQuestion');
            const optionsDiv = document.getElementById('analogyOptions');
            
            questionDiv.textContent = analogy.question;
            optionsDiv.innerHTML = '';
            
            analogy.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => checkAnalogy(index === analogy.correct);
                optionsDiv.appendChild(button);
            });
            
            currentAnalogy++;
        }

        function checkAnalogy(isCorrect) {
            const resultDiv = document.getElementById('analogyResult');
            if (isCorrect) {
                updateScore(10, 'analogies');
                resultDiv.textContent = 'נכון!';
                resultDiv.className = 'result correct';
                } else {
                resultDiv.textContent = 'לא נכון';
                resultDiv.className = 'result wrong';
            }
            setTimeout(nextAnalogy, 1500);
        }

        let currentSequence = 0;
        function showNextSequence() {
            const sequence = questionBank.sequences[currentSequence % questionBank.sequences.length];
            document.getElementById('sequenceQuestion').textContent = 
                `השלם את הסדרה: ${sequence.pattern.join(', ')}, ?`;
            currentSequence++;
        }

        function checkSequence() {
            const sequence = questionBank.sequences[(currentSequence - 1) % questionBank.sequences.length];
            const userAnswer = parseInt(document.getElementById('sequenceInput').value);
            const resultDiv = document.getElementById('sequenceResult');
            
            if (userAnswer === sequence.next) {
                updateScore(15, 'sequences');
                resultDiv.textContent = `נכון! ${sequence.rule}`;
                resultDiv.className = 'result correct';
            } else {
                resultDiv.textContent = `לא נכון. התשובה הנכונה היא ${sequence.next}. ${sequence.rule}`;
                resultDiv.className = 'result wrong';
            }
            
            setTimeout(showNextSequence, 2000);
            document.getElementById('sequenceInput').value = '';
        }

        // Similar implementations for shapes, math, and logic questions...
        // The actual implementation would include all the functions mentioned above
        // but I'm showing the key ones for brevity

        // Timer functionality
        let timerInterval;
        let timeLeft = 45 * 60; // 45 minutes in seconds

        function toggleTimer() {
            const button = document.getElementById('timerControl');
            if (button.textContent === 'התחל') {
                startTimer();
                button.textContent = 'עצור';
        } else {
                stopTimer();
                button.textContent = 'התחל';
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    stopTimer();
                    alert('הזמן נגמר!');
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Navigation functionality
        function showSection(sectionName) {
            const sections = ['analogies', 'sequences', 'shapes', 'quantitative', 'logic'];
            sections.forEach(section => {
                const element = document.getElementById(section + 'Window');
                if (element) {
                    element.style.display = section === sectionName ? 'block' : 'none';
                }
            });
        }

        // Marked questions functionality
        let markedQuestions = new Set();

        function toggleMarkQuestion(questionId) {
            if (markedQuestions.has(questionId)) {
                markedQuestions.delete(questionId);
                } else {
                markedQuestions.add(questionId);
            }
            LocalStorageManager.setItem('markedQuestions', Array.from(markedQuestions));
            updateMarkButton(questionId);
        }

        function updateMarkButton(questionId) {
            const button = document.querySelector(`[data-question-id="${questionId}"]`);
            if (button) {
                button.classList.toggle('marked', markedQuestions.has(questionId));
            }
        }

        function showMarked() {
            const markedList = Array.from(markedQuestions);
            if (markedList.length === 0) {
                alert('אין שאלות מסומנות');
                return;
            }
            
            const message = `שאלות מסומנות:\n${markedList.join('\n')}`;
            alert(message);
        }

        // Statistics functionality
        function showStats() {
            const stats = {
                total: totalScore,
                analogies: currentScores.analogies,
                sequences: currentScores.sequences,
                shapes: currentScores.shapes,
                quantitative: currentScores.quantitative,
                logic: currentScores.logic
            };

            const message = `
                סטטיסטיקות:
                ציון כולל: ${stats.total}
                אנלוגיות: ${stats.analogies}
                סדרות: ${stats.sequences}
                צורות: ${stats.shapes}
                כמותי: ${stats.quantitative}
                היסקים: ${stats.logic}
            `;
            alert(message);
        }

        // Save progress functionality
        function saveProgress() {
            const progress = {
                scores: currentScores,
                totalScore: totalScore,
                markedQuestions: Array.from(markedQuestions),
                timeLeft: timeLeft
            };

            LocalStorageManager.setItem('testProgress', progress);
            alert('ההתקדמות נשמרה בהצלחה');
        }

        // Load saved progress
        function loadProgress() {
            const savedProgress = LocalStorageManager.getItem('testProgress', null);
            if (savedProgress) {
                currentScores = savedProgress.scores;
                totalScore = savedProgress.totalScore;
                markedQuestions = new Set(savedProgress.markedQuestions);
                timeLeft = savedProgress.timeLeft;
                updateTimerDisplay();
                updateProgressBar();
                document.getElementById('totalScore').textContent = totalScore;
            }
        }

        // Add mark button to each question
        function addMarkButtons() {
            const questions = document.querySelectorAll('.question');
            questions.forEach((question, index) => {
                const markButton = document.createElement('button');
                markButton.className = 'mark-btn';
                markButton.textContent = 'סמן לחזרה';
                markButton.dataset.questionId = `question-${index + 1}`;
                markButton.onclick = () => toggleMarkQuestion(`question-${index + 1}`);
                question.appendChild(markButton);
            });
        }

        // Test type management
        let currentTestType = 'practice';
        
        function setTestType(type) {
            currentTestType = type;
            document.querySelectorAll('.test-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[onclick="setTestType('${type}')"]`).classList.add('active');
            
            switch(type) {
                case 'practice':
                    timeLeft = 45 * 60; // 45 minutes
                    break;
                case 'real':
                    timeLeft = 20 * 60; // 20 minutes per section
                    break;
                case 'quick':
                    timeLeft = 10 * 60; // 10 minutes
                    break;
            }
            updateTimerDisplay();
        }

        // Refined Calculator Logic
        let calculatorDisplayValue = '';
        const calculatorDisplayId = 'calculatorDisplayInput'; // Consistent ID

        function setupCalculator() {
            const calculatorGrid = document.querySelector('#calculator .calculator-grid');
            if (!calculatorGrid) {
                console.error("Calculator grid not found!");
                return;
            }
            calculatorGrid.innerHTML = ''; // Clear previous buttons if any, to prevent duplication

            // Create display
            const display = document.createElement('input');
            display.type = 'text';
            display.id = calculatorDisplayId;
            display.readOnly = true;
            display.style.width = '100%';
            display.style.gridColumn = '1 / -1'; // Span across all columns
            display.style.marginBottom = '10px';
            display.style.textAlign = 'right';
            display.style.padding = '5px';
            calculatorGrid.appendChild(display);

            const buttons = [
                'C', 'DEL', '%', '/',
                '7', '8', '9', '*',
                '4', '5', '6', '-',
                '1', '2', '3', '+',
                '0', '.', '+/-', '='
            ];

            buttons.forEach(btnText => {
                const button = document.createElement('button');
                button.textContent = btnText;
                button.onclick = () => handleCalculatorInput(btnText);
                calculatorGrid.appendChild(button);
            });
            updateCalculatorDisplay(); // Initialize display
        }

        // This new function is needed by the refined setupCalculator and handleCalculatorInput
        function updateCalculatorDisplay() {
            const displayField = document.getElementById(calculatorDisplayId);
            if (displayField) {
                displayField.value = calculatorDisplayValue;
            }
        }

        // Drawing pad functionality
        function setupDrawingPad() {
            const canvas = document.getElementById('drawingPad');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                draw(e);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const color = document.getElementById('colorPicker').value;
                const size = document.getElementById('brushSize').value;
                
                ctx.lineWidth = size;
                ctx.lineCap = 'round';
                ctx.strokeStyle = color;
                
                ctx.lineTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
            }
            
            function stopDrawing() {
                isDrawing = false;
                ctx.beginPath();
            }
        }

        // Mistake analysis
        function showMistakes() {
            const mistakes = analyzeMistakes();
            const message = `
                ניתוח טעויות:
                
                אנלוגיות מילוליות: ${mistakes.analogies.count} טעויות
                דפוס נפוץ: ${mistakes.analogies.pattern}
                
                השלמת סדרות: ${mistakes.sequences.count} טעויות
                דפוס נפוץ: ${mistakes.sequences.pattern}
                
                סדרות צורות: ${mistakes.shapes.count} טעויות
                דפוס נפוץ: ${mistakes.shapes.pattern}
                
                חשיבה כמותית: ${mistakes.quantitative.count} טעויות
                דפוס נפוץ: ${mistakes.quantitative.pattern}
                
                היסקים לוגיים: ${mistakes.logic.count} טעויות
                דפוס נפוץ: ${mistakes.logic.pattern}
                
                המלצות לשיפור:
                ${mistakes.recommendations.join('\n')}
            `;
            alert(message);
        }

        function analyzeMistakes() {
            // Analyze mistakes and return patterns
            return {
                analogies: {
                    count: 0,
                    pattern: "קושי בזיהוי יחסים מופשטים"
                },
                sequences: {
                    count: 0,
                    pattern: "טעויות בזיהוי חוקיות מתמטית"
                },
                shapes: {
                    count: 0,
                    pattern: "קושי בזיהוי דפוסים מרחביים"
                },
                quantitative: {
                    count: 0,
                    pattern: "טעויות בחישובים בסיסיים"
                },
                logic: {
                    count: 0,
                    pattern: "קושי בהסקת מסקנות לוגיות"
                },
                recommendations: [
                    "התמקד בהבנת היחסים הבסיסיים באנלוגיות",
                    "תרגל זיהוי חוקיות בסדרות פשוטות",
                    "עבוד על הבנה מרחבית של צורות",
                    "חזור על יסודות המתמטיקה",
                    "תרגל הסקת מסקנות בשלבים"
                ]
            };
        }

        // Tips and explanations
        function toggleTips() {
            const currentSection = document.querySelector('.window:not([style*="display: none"])');
            if (!currentSection) return;
            
            const sectionId = currentSection.id.replace('Window', '');
            const tips = getTipsForSection(sectionId);
            alert(tips);
        }

        function getTipsForSection(section) {
            const tips = {
                analogies: `
                    טיפים לאנלוגיות מילוליות:
                    1. זהה את סוג היחס בין המילה הראשונה לשנייה
                    2. חפש יחס דומה בין המילה השלישית לאפשרויות
                    3. בדוק שהיחס עובד בשני הכיוונים
                    4. שים לב למשמעויות נוספות של המילים
                `,
                sequences: `
                    טיפים להשלמת סדרות:
                    1. חפש דפוס קבוע בין המספרים
                    2. נסה לזהות פעולות חשבון בסיסיות
                    3. בדוק אם יש שילוב של כמה חוקים
                    4. חשוב על סדרות מוכרות (ריבועים, מכפלות)
                `,
                shapes: `
                    טיפים לסדרות צורות:
                    1. שים לב לשינויים בצורה, בגודל ובכיוון
                    2. חפש דפוסים חוזרים
                    3. בדוק שינויים במספר האלמנטים
                    4. זהה חוקיות בסיבוב או שיקוף
                `,
                quantitative: `
                    טיפים לחשיבה כמותית:
                    1. ארגן את הנתונים בצורה ברורה
                    2. השתמש בשרטוט אם אפשר
                    3. בדוק את ההיגיון של התשובה
                    4. חפש דרכים יצירתיות לפתרון
                `,
                logic: `
                    טיפים להיסקים לוגיים:
                    1. קרא את כל הנתונים בעיון
                    2. סמן מידע חשוב
                    3. צייר תרשים של היחסים
                    4. בדוק כל מסקנה מול הנתונים
                `
            };
            return tips[section] || "בחר חלק במבחן כדי לראות טיפים";
        }

        // Temperature Converter
        function convertTemperature() {
            const celsius = parseFloat(document.getElementById('celsius').value);
            const fahrenheit = (celsius * 9/5) + 32;
            const kelvin = celsius + 273.15;
            document.getElementById('tempResult').innerHTML = `
                פרנהייט: ${fahrenheit.toFixed(1)}°F<br>
                קלווין: ${kelvin.toFixed(1)}K
            `;
        }

        // Random Sentence Generator
        const sentences = {
            subjects: ['תלמיד', 'מורה', 'רופא', 'מהנדס', 'אמן', 'סופר', 'חייל', 'שופט', 'מדען'],
            verbs: ['לומד', 'מלמד', 'מרפא', 'בונה', 'יוצר', 'כותב', 'מגן', 'שופט', 'חוקר'],
            objects: ['ספר', 'שיעור', 'תרופה', 'בניין', 'ציור', 'סיפור', 'מדינה', 'משפט', 'תגלית']
        };

        function generateSentence() {
            const subject = sentences.subjects[Math.floor(Math.random() * sentences.subjects.length)];
            const verb = sentences.verbs[Math.floor(Math.random() * sentences.verbs.length)];
            const object = sentences.objects[Math.floor(Math.random() * sentences.objects.length)];
            document.getElementById('sentenceResult').textContent = `${subject} ${verb} ${object}`;
        }

        // Password Generator
        function generatePassword() {
            const length = 12;
            const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';
            let password = '';
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            document.getElementById('passwordResult').textContent = password;
        }

        // Time Calculator
        function calculateTimeDifference() {
            const date1 = new Date(document.getElementById('date1').value);
            const date2 = new Date(document.getElementById('date2').value);
            const diffTime = Math.abs(date2 - date1);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('timeResult').textContent = `ההפרש הוא ${diffDays} ימים`;
        }

        // Number Sequence Practice
        function generateNewSequence() {
            const types = [
                {
                    generate: () => {
                        const start = Math.floor(Math.random() * 10) + 1;
                        const step = Math.floor(Math.random() * 5) + 2;
                        return {
                            sequence: Array.from({length: 5}, (_, i) => start + (i * step)),
                            next: start + (5 * step),
                            explanation: `כל מספר גדול ב-${step} מהמספר הקודם`
                        };
                    }
                },
                {
                    generate: () => {
                        const start = Math.floor(Math.random() * 5) + 1;
                        return {
                            sequence: Array.from({length: 5}, (_, i) => start * Math.pow(2, i)),
                            next: start * Math.pow(2, 5),
                            explanation: 'כל מספר הוא כפול 2 מהמספר הקודם'
                        };
                    }
                }
            ];

            const generator = types[Math.floor(Math.random() * types.length)];
            const result = generator.generate();
            
            document.getElementById('currentSequence').textContent = result.sequence.join(', ') + ', ?';
            document.getElementById('currentSequence').dataset.next = result.next;
            document.getElementById('currentSequence').dataset.explanation = result.explanation;
        }

        function checkSequencePractice() {
            const answer = parseFloat(document.getElementById('sequenceAnswer').value);
            const correct = parseFloat(document.getElementById('currentSequence').dataset.next);
            const explanation = document.getElementById('currentSequence').dataset.explanation;
            
            if (answer === correct) {
                alert(`נכון! ${explanation}`);
            } else {
                alert(`לא נכון. התשובה הנכונה היא ${correct}. ${explanation}`);
            }
        }

        // Word Relations Practice
        const wordRelations = [
            {word1: 'ספר', word2: 'סופר', relation: 'תוצר-יוצר'},
            {word1: 'מורה', word2: 'תלמיד', relation: 'מלמד-לומד'},
            {word1: 'רופא', word2: 'חולה', relation: 'מטפל-מטופל'},
            // Add more word pairs and relations
        ];

        function getRandomWordPair() {
            const pair = wordRelations[Math.floor(Math.random() * wordRelations.length)];
            document.getElementById('word1').value = pair.word1;
            document.getElementById('word2').value = pair.word2;
        }

        function analyzeWordRelation() {
            const word1 = document.getElementById('word1').value;
            const word2 = document.getElementById('word2').value;
            const relation = wordRelations.find(r => r.word1 === word1 && r.word2 === word2);
            
            if (relation) {
                alert(`הקשר בין המילים: ${relation.relation}`);
            } else {
                alert('נסה זוג מילים אחר או השתמש בכפתור "זוג מילים אקראי"');
            }
        }

        // Logic Problems
        const logicProblems = [
            {
                question: 'דני גבוה מיוסי. יוסי גבוה מרון. מי הכי נמוך?',
                options: ['דני', 'יוסי', 'רון'],
                correct: 2,
                explanation: 'אם דני גבוה מיוסי ויוסי גבוה מרון, אז רון הכי נמוך'
            },
            // Add more logic problems
        ];

        function generateLogicProblem() {
            const problem = logicProblems[Math.floor(Math.random() * logicProblems.length)];
            document.getElementById('logicProblemText').textContent = problem.question;
            
            const optionsDiv = document.getElementById('logicAnswerOptions');
            optionsDiv.innerHTML = '';
            problem.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => checkLogicAnswer(index === problem.correct, problem.explanation);
                optionsDiv.appendChild(button);
            });
        }

        function checkLogicAnswer(isCorrect, explanation) {
            alert(isCorrect ? `נכון! ${explanation}` : `לא נכון. ${explanation}`);
        }

        // Coding Problems Database
        const codingProblems = [
            {
                title: "סכום מערך",
                description: "כתוב פונקציה שמחשבת את סכום כל המספרים במערך",
                examples: [
                    "Input: [1, 2, 3, 4, 5]",
                    "Output: 15"
                ],
                difficulty: "קל"
            },
            {
                title: "היפוך מחרוזת",
                description: "כתוב פונקציה שהופכת מחרוזת",
                examples: [
                    "Input: 'Hello'",
                    "Output: 'olleH'"
                ],
                difficulty: "קל"
            },
            {
                title: "מספר פיבונאצ'י",
                description: "כתוב פונקציה שמחשבת את המספר ה-n בסדרת פיבונאצ'י",
                examples: [
                    "Input: n = 6",
                    "Output: 8"
                ],
                difficulty: "בינוני"
            }
        ];

        function generateCodingProblem() {
            const problem = codingProblems[Math.floor(Math.random() * codingProblems.length)];
            const problemDisplay = document.getElementById('codingProblem');
            problemDisplay.innerHTML = `
                <h4>${problem.title}</h4>
                <p>רמת קושי: ${problem.difficulty}</p>
                <p>${problem.description}</p>
                <div class="examples">
                    <p>דוגמאות:</p>
                    ${problem.examples.map(ex => `<code>${ex}</code>`).join('<br>')}
    </div>
            `;
        }

        function checkCode() {
            const code = document.getElementById('codeSubmission').value;
            // כאן אפשר להוסיף בדיקת קוד אמיתית
            alert('הקוד נשלח לבדיקה!');
        }

        // Sentence Completion
        function checkSentenceCompletion(answer) {
            const correctAnswer = 0; // העובד / התעקש
            if (answer === correctAnswer) {
                showSuccess("נכון! זוהי ההשלמה ההגיונית ביותר למשפט.");
            } else {
                showError("לא נכון. חשוב על הקשר הלוגי בין שני חלקי המשפט.");
            }
        }

        // Word Relations
        function checkWordRelation(answer) {
            const correctAnswer = 0; // לימוד : ידע
            if (answer === correctAnswer) {
                showSuccess("נכון! כמו שמחקר מוביל לתגלית, כך לימוד מוביל לידע.");
            } else {
                showError("לא נכון. חפש יחס של תהליך ותוצאה.");
            }
        }

        // Complex Problem
        function checkComplexProblem() {
            const answer = parseFloat(document.getElementById('complexProblemAnswer').value);
            const correctAnswer = 9.09; // (1.2/1.1 - 1) * 100
            if (Math.abs(answer - correctAnswer) < 0.1) {
                showSuccess("נכון! השתמשת נכון בנוסחת השטח ובחישוב אחוזים.");
            } else {
                showError(`לא נכון. חשוב: אם השטח גדל ב-20% והאורך ב-10%, אז (1.2/1.1 - 1) * 100 = ${correctAnswer}%`);
            }
        }

        // Data Analysis
        function setupDataChart() {
            const ctx = document.getElementById('dataChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2019', '2020', '2021', '2022'],
                    datasets: [{
                        label: 'נתוני צמיחה',
                        data: [100, 120, 150, 140],
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                }
            });
        }

        // Logic Puzzle
        function checkLogicPuzzle() {
            const answer = parseInt(document.getElementById('logicPuzzleAnswer').value);
            const correctAnswer = 5;
            if (answer === correctAnswer) {
                showSuccess("נכון! הצלחת לפתור את החידה הלוגית.");
            } else {
                showError("לא נכון. נסה לארגן את הנתונים בטבלה ולפתור בשלבים.");
            }
        }

        // Pattern Recognition
        function generatePatternGrid() {
            const grid = document.querySelector('.pattern-grid');
            const pattern = [
                'A', 'B', 'A', 'C',
                'B', 'A', 'C', 'A',
                'A', 'C', 'A', 'B',
                'C', 'A', 'B', '?'
            ];
            
            pattern.forEach(item => {
                const cell = document.createElement('div');
                cell.className = 'pattern-cell';
                cell.textContent = item;
                grid.appendChild(cell);
            });
        }

        // Success/Error Messages
        function showSuccess(message) {
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function showError(message) {
            const notification = document.createElement('div');
            notification.className = 'notification error';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Initialize everything
        window.addEventListener('load', () => {
            updateOnlineStatus();
            loadQuestions();
            updateProgressBar();
            loadProgress();
            addMarkButtons();
            setupCalculator();
            setupDrawingPad();
            generateNewSequence();
            generateLogicProblem();
            setupDataChart();
            generatePatternGrid();

            // Initialize question displays for sections that don't auto-load
            if (typeof nextAnalogy === "function") nextAnalogy();
            if (typeof showNextSequence === "function") showNextSequence();
            if (typeof nextShape === "function") nextShape(); // Initialize shapes
            if (typeof showNextMathQuestion === "function") showNextMathQuestion(); // Initialize math
            if (typeof showNextLogicQuestion === "function") showNextLogicQuestion(); // Initialize logic
        });

        // Python Practice Functions
        
        function checkPythonSolution(exerciseType) {
            switch(exerciseType) {
                case 'list_comprehension':
                    const solution = [3, 6, 9, 12, 15, 18];
                    const userSolution = prompt('הכנס את הפתרון שלך (מספרים מופרדים בפסיקים):')
                        .split(',')
                        .map(x => parseInt(x.trim()));
                    
                    if (arraysEqual(solution, userSolution)) {
                        showSuccess('נכון! הצלחת ליצור list comprehension נכון');
            } else {
                        showError('לא נכון. נסה שוב');
                    }
                    break;
            }
        }

        function analyzePythonSequence() {
            const sequence = document.getElementById('sequence_input')
                .value
                .split(',')
                .map(x => parseFloat(x.trim()));
            
            let pattern = findPattern(sequence);
            showSuccess(`הדפוס שנמצא: ${pattern}`);
        }

        function findPattern(sequence) {
            if (sequence.length < 2) return 'נדרשים לפחות שני מספרים';
            
            // Check multiplication pattern
            const multRatio = sequence[1] / sequence[0];
            if (sequence.every((num, i) => i === 0 || num / sequence[i-1] === multRatio)) {
                return `כפל ב-${multRatio}`;
            }
            
            // Check addition pattern
            const addDiff = sequence[1] - sequence[0];
            if (sequence.every((num, i) => i === 0 || num - sequence[i-1] === addDiff)) {
                return `חיבור ${addDiff}`;
            }
            
            return 'לא נמצא דפוס פשוט';
        }

        function calculateRecursive() {
            const num = parseInt(document.getElementById('recursive_input').value);
            const result = sumDigits(num);
            showSuccess(`סכום הספרות של ${num} הוא ${result}`);
        }

        function sumDigits(n) {
            if (n < 10) return n;
            return n % 10 + sumDigits(Math.floor(n / 10));
        }

        function testAlgorithm() {
            const arr = [1, 3, 5, 7, 9, 11, 13, 15];
            const target = 7;
            const result = binarySearch(arr, target);
            showSuccess(`המספר ${target} נמצא במיקום ${result}`);
        }

        function binarySearch(arr, target) {
            let left = 0;
            let right = arr.length - 1;
            
            while (left <= right) {
                const mid = Math.floor((left + right) / 2);
                if (arr[mid] === target) return mid;
                if (arr[mid] < target) left = mid + 1;
                else right = mid - 1;
            }
            
            return -1;
        }

        function checkExpression() {
            const expr = document.getElementById('expression_input').value;
            const isBalanced = checkBalancedParentheses(expr);
            if (isBalanced) {
                showSuccess('הסוגריים מאוזנים');
            } else {
                showError('הסוגריים אינם מאוזנים');
            }
        }

        function checkBalancedParentheses(expr) {
            const stack = [];
            const pairs = {')': '(', ']': '[', '}': '{'};
            
            for (let char of expr) {
                if ('([{'.includes(char)) {
                    stack.push(char);
                } else if (')]}'.includes(char)) {
                    if (!stack.length || stack.pop() !== pairs[char]) {
                        return false;
                    }
                }
            }
            
            return stack.length === 0;
        }

        function analyzeProblem() {
            const problem = document.getElementById('problem_input').value;
            const analysis = `
                ניתוח הבעיה:
                1. הבנת הדרישות: ${problem}
                2. זיהוי קלטים: ${identifyInputs(problem)}
                3. זיהוי פלטים: ${identifyOutputs(problem)}
                4. מגבלות: יש לבדוק מקרי קצה
            `;
            showSuccess(analysis);
        }

        function identifyInputs(problem) {
            return 'נדרש ניתוח מעמיק של הקלט';
        }

        function identifyOutputs(problem) {
            return 'נדרש ניתוח מעמיק של הפלט הרצוי';
        }

        function arraysEqual(arr1, arr2) {
            if (arr1.length !== arr2.length) return false;
            return arr1.every((val, idx) => val === arr2[idx]);
        }

        // --- Added functions for missing button handlers ---

        function toggleToolWindow(windowId) {
            const toolWindow = document.getElementById(windowId);
            if (toolWindow) {
                toolWindow.style.display = toolWindow.style.display === 'none' || toolWindow.style.display === '' ? 'block' : 'none';
            } else {
                console.error("Tool window element not found:", windowId);
            }
        }

        function toggleCalculator() {
            toggleToolWindow('calculator');
        }

        function toggleScratchPad() {
            toggleToolWindow('scratchPad');
        }

        function toggleFormulas() {
            toggleToolWindow('formulas');
        }

        function toggleInstructions() {
            alert('הוראות למבחן (יש להוסיף תוכן זה).');
        }

        let currentShape = 0;
        function nextShape() {
            const shapeQuestionDiv = document.getElementById('shapeQuestion');
            const shapeOptionsDiv = document.getElementById('shapeOptions');
            const shapeResultDiv = document.getElementById('shapeResult');
            
            shapeResultDiv.textContent = ''; // Clear previous result
            
            if (questionBank.shapes && questionBank.shapes.length > 0) {
                const shape = questionBank.shapes[currentShape % questionBank.shapes.length];
                shapeQuestionDiv.textContent = shape.question;
                shapeOptionsDiv.innerHTML = '';
                shape.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.onclick = () => checkShape(index === shape.correct);
                    shapeOptionsDiv.appendChild(button);
                });
                currentShape++;
            } else {
                shapeQuestionDiv.textContent = 'אין שאלות צורות זמינות.';
                shapeOptionsDiv.innerHTML = '';
            }
        }
        
        function checkShape(isCorrect) {
            const resultDiv = document.getElementById('shapeResult');
            if (isCorrect) {
                updateScore(10, 'shapes'); // Assuming 10 points for shapes
                resultDiv.textContent = 'נכון!';
                resultDiv.className = 'result correct';
            } else {
                resultDiv.textContent = 'לא נכון.';
                resultDiv.className = 'result wrong';
            }
            setTimeout(nextShape, 1500);
        }


        let currentMathQuestion = 0;
        function showNextMathQuestion() {
            const mathQuestionDiv = document.getElementById('mathQuestion');
            const mathResultDiv = document.getElementById('mathResult');
            document.getElementById('mathInput').value = ''; // Clear previous input
            mathResultDiv.textContent = ''; // Clear previous result

            if (questionBank.quantitative && questionBank.quantitative.length > 0) {
                const questionData = questionBank.quantitative[currentMathQuestion % questionBank.quantitative.length];
                mathQuestionDiv.textContent = questionData.question;
                // Store answer for checking, e.g., in a data attribute or a global variable
                mathQuestionDiv.dataset.answer = questionData.answer;
                mathQuestionDiv.dataset.explanation = questionData.explanation;
            } else {
                mathQuestionDiv.textContent = 'אין שאלות כמותיות זמינות.';
            }
        }

        function checkMath() {
            const mathQuestionDiv = document.getElementById('mathQuestion');
            const userAnswer = parseFloat(document.getElementById('mathInput').value);
            const correctAnswer = parseFloat(mathQuestionDiv.dataset.answer);
            const explanation = mathQuestionDiv.dataset.explanation;
            const resultDiv = document.getElementById('mathResult');

            if (!isNaN(userAnswer) && userAnswer === correctAnswer) {
                updateScore(15, 'quantitative'); // Assuming 15 points
                resultDiv.textContent = `נכון! ${explanation || ''}`;
                resultDiv.className = 'result correct';
            } else {
                resultDiv.textContent = `לא נכון. התשובה הנכונה היא ${correctAnswer}. ${explanation || ''}`;
                resultDiv.className = 'result wrong';
            }
            currentMathQuestion++;
            setTimeout(showNextMathQuestion, 2000);
        }

        let currentLogicQuestionIndex = 0;
        function showNextLogicQuestion() {
            const logicQuestionDiv = document.getElementById('logicQuestion');
            const logicOptionsDiv = document.getElementById('logicOptions');
            const logicResultDiv = document.getElementById('logicResult');

            logicResultDiv.textContent = ''; // Clear previous result
            logicOptionsDiv.innerHTML = ''; // Clear previous options

            if (questionBank.logic && questionBank.logic.length > 0) {
                const questionData = questionBank.logic[currentLogicQuestionIndex % questionBank.logic.length];
                logicQuestionDiv.textContent = questionData.question;
                
                questionData.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.onclick = () => {
                        // Call checkLogic with specific parameters for this question type
                        checkLogic(index === questionData.correct, questionData.explanation);
                    };
                    logicOptionsDiv.appendChild(button);
                });
            } else {
                logicQuestionDiv.textContent = 'אין שאלות היגיון זמינות.';
            }
        }
        
        function checkLogic(isCorrect, explanation) {
            const resultDiv = document.getElementById('logicResult');
            if (isCorrect) {
                updateScore(10, 'logic'); // Assuming 10 points
                resultDiv.textContent = `נכון! ${explanation || ''}`;
                resultDiv.className = 'result correct';
            } else {
                resultDiv.textContent = `לא נכון. ${explanation || ''}`;
                resultDiv.className = 'result wrong';
            }
            currentLogicQuestionIndex++;
            setTimeout(showNextLogicQuestion, 2000);
        }


        // The new handleCalculatorInput function (replaces the old one and the logic of ensureCalculatorDisplay)
        function handleCalculatorInput(value) {
            if (value === '=') {
                try {
                    let expression = calculatorDisplayValue.replace('×', '*').replace('÷', '/');
                    calculatorDisplayValue = eval(expression).toString();
                } catch (e) {
                    calculatorDisplayValue = 'Error';
                }
            } else if (value === 'C') {
                calculatorDisplayValue = '';
            } else if (value === 'DEL') {
                calculatorDisplayValue = calculatorDisplayValue.slice(0, -1);
            } else if (value === '+/-') {
                if (calculatorDisplayValue.startsWith('-')) {
                    calculatorDisplayValue = calculatorDisplayValue.substring(1);
                } else if (calculatorDisplayValue !== '' && calculatorDisplayValue !== '0' && calculatorDisplayValue !== 'Error') {
                    calculatorDisplayValue = '-' + calculatorDisplayValue;
                }
            } else if (value === '%') {
                 try {
                    let expression = calculatorDisplayValue.replace('×', '*').replace('÷', '/');
                    calculatorDisplayValue = (eval(expression) / 100).toString();
                } catch (e) {
                    calculatorDisplayValue = 'Error';
                }
            }
            else { 
                if (calculatorDisplayValue === 'Error') calculatorDisplayValue = '';
                // Prevent multiple operators or leading operators if desired (more complex logic)
                // For now, simple concatenation
                calculatorDisplayValue += value;
            }
            updateCalculatorDisplay();
        }

        function clearPad() {
            const canvas = document.getElementById('drawingPad');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath(); // Reset path
                // alert('דף הטיוטה נוקה.');
            } else {
                alert('אלמנט דף הטיוטה לא נמצא.');
            }
        }

        function checkDataAnalysis() {
            const userAnswer = parseFloat(document.getElementById('dataAnalysisAnswer').value);
            // Example: assuming correct answer is 25% change from 120 to 150
            const correctAnswer = 25; // (150-120)/120 * 100
            if (!isNaN(userAnswer) && Math.abs(userAnswer - correctAnswer) < 0.1) {
                showSuccess("נכון! אחוז השינוי חושב כהלכה.");
            } else {
                showError(`לא נכון. התשובה הנכונה היא ${correctAnswer}%. בדוק את חישוב אחוז השינוי.`);
            }
        }

        function checkPattern(selectedIndex) {
            // Example: For the pattern A, B, A, C, B, A, C, A, A, C, A, B, C, A, B, ?
            // The next logical item might be 'A' if a certain sequence repeats.
            // This is highly dependent on the specific pattern generated.
            // For now, let's assume a correct answer (e.g., 0 for option A).
            const correctPatternIndex = 0; // Placeholder
            if (selectedIndex === correctPatternIndex) {
                showSuccess("נכון! זיהית את הדפוס הנכון.");
            } else {
                showError("לא נכון. נסה לזהות את החוקיות בדפוס.");
            }
        }
        
        // --- End of added functions ---
    </script>
</body>
</html>


